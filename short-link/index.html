<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>短链接生成器</title>
    <link rel="shortcut icon" href="https://cdn.micono.eu.org/icon/logo.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript">
        ((c, l, a, r, i, t, y) => {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "spxwf705l5");
    </script>
    <link rel="stylesheet" href="https://cdn.oplist.org/gh/YangRucheng/EdgeOne-Pages@main/assets/css/link.css">
</head>

<body>
    <div class="container" id="main">
        <h2>短链接生成器</h2>

        <div id="generator">
            <div class="label">原始链接：</div>
            <input type="text" id="input" placeholder="请输入要生成的原始链接~">

            <div class="label">短链接：</div>
            <input type="text" id="output" placeholder="点击复制" readonly>

            <button class="btn" id="genBtn">生成短链接</button>
        </div>

        <div id="redirect" style="display:none;">
            <a id="redirectLink" class="btn" href="#" target="_blank" referrerpolicy="no-referrer">前往原始链接</a>
        </div>
    </div>

    <script>
        const normalizeUrl = url =>
            url.startsWith("http://") || url.startsWith("https://") ? url : `https://${url}`;

        const generateLink = () => {
            let text = document.getElementById("input").value.trim();
            if (!text) return alert("欸~ 主人要先输入原始链接哦~♡");
            text = normalizeUrl(text);

            fetch("/api/create", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url: text })
            })
                .then(resp => resp.json())
                .then(res => {
                    if (res.status == 0) {
                        const url = `${location.origin}/s/${res.path}`;
                        document.getElementById("output").value = url;
                        document.getElementById("output").onclick = () => navigator.clipboard.writeText(url);
                    } else {
                        alert(res.msg);
                    }
                })
        };
        document.getElementById("genBtn").onclick = generateLink;
    </script>
</body>

</html>